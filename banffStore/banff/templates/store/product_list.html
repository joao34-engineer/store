{% extends 'base/base.html' %}
{% block title %}Shop{% endblock %}
{% block content %}
<div class="container">
  <h1>Shop</h1>
  <form method="get" class="search-sort">
    <input type="text" name="q" value="{{ request.GET.q }}" placeholder="Search products..."/>
    <select name="sort">
      <option value="">Sort by</option>
      <option value="price_asc" {% if request.GET.sort == 'price_asc' %}selected{% endif %}>Price: Low to High</option>
      <option value="price_desc" {% if request.GET.sort == 'price_desc' %}selected{% endif %}>Price: High to Low</option>
    </select>
    <button type="submit">Apply</button>
  </form>

  <aside>
    <h3>Categories</h3>
    <ul>
      <li><a href="{% url 'store:product_list' %}" {% if not active_category %}class="active"{% endif %}>All</a></li>
      {% for c in categories %}
      <li>
        <a href="{% url 'store:category_products' c.slug %}" {% if active_category and c.id == active_category.id %}class="active"{% endif %}>{{ c.name }}</a>
      </li>
      {% endfor %}
    </ul>
  </aside>

  <section class="products">
    {% for p in products %}
    <article class="product">
      <a href="{% url 'store:product_detail' p.slug %}">
        {% if p.image %}<img src="{{ p.image.url }}" alt="{{ p.name }}"/>{% endif %}
        <h4>{{ p.name }}</h4>
      </a>
      <p>${{ p.price }}</p>
      <form method="post" action="{% url 'store:add_to_cart' %}">
        {% csrf_token %}
        <input type="hidden" name="product" value="{{ p.slug }}"/>
        <input type="number" min="1" name="quantity" value="1"/>
        <button type="submit">Add to cart</button>
      </form>
    </article>
    {% empty %}
      <p>No products found.</p>
    {% endfor %}
  </section>
</div>
{% endblock %}
